{"version":3,"sources":["../source/Form.js"],"names":["Form","submit","bind","on_key_down","props","post","error","className","style","markup","render_children","children","form_elements","Children","toArray","error_element","index","child","type","Error","cloneElement","key","Actions","insert_at","push","event","preventDefault","busy","keyCode","cancel","propTypes","func","oneOfType","string","bool","node","isRequired","object","defaultProps","rrui__modal","context","register_form","unregister_form","close_if_not_busy","closeLabel","contextTypes"],"mappings":"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","file":"Form.js","sourcesContent":["import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\n\nimport Button from './Button'\n\n// Prevents `<form/> submission when `busy` is `true`.\n// And also inserts `<Form.Error/>` when `error` is passed.\n// Using `Component` here instead of `PureComponent`\n// because `<Form.Actions>` depends on `context` and therefore\n// should be rerendered even if the `props` haven't changed.\n// And probably that was also why it would keep displaying an old error\n// (and not resetting it for some reason).\nexport default class Form extends Component\n{\n\tstatic propTypes =\n\t{\n\t\t// `onSubmit` handler\n\t\tsubmit      : PropTypes.func,\n\n\t\t// On `Escape` keydown handler\n\t\tcancel      : PropTypes.func,\n\n\t\t// `error` can be passed for non-javascript old-school forms.\n\t\t// e.g. when a form submitted via HTTP POST request had an error,\n\t\t// then this error is rendered as part of the form.\n\t\terror       : PropTypes.oneOfType([PropTypes.string, PropTypes.bool, PropTypes.node]),\n\n\t\t// The HTML form `action` attribute,\n\t\t// i.e. the URL to which the form will be posted\n\t\t// in case of a non-javascript old-school POST submission.\n\t\tpost        : PropTypes.string,\n\n\t\t// Is form submission in progress\n\t\tbusy        : PropTypes.bool.isRequired,\n\n\t\t// CSS class\n\t\tclassName   : PropTypes.string,\n\n\t\t// CSS style object\n\t\tstyle       : PropTypes.object\n\t}\n\n\tstatic defaultProps =\n\t{\n\t\tbusy : false\n\t}\n\n\tconstructor()\n\t{\n\t\tsuper()\n\n\t\tthis.submit      = this.submit.bind(this)\n\t\tthis.on_key_down = this.on_key_down.bind(this)\n\t}\n\n\trender()\n\t{\n\t\tconst { post, error, className, style } = this.props\n\n\t\tconst markup =\n\t\t(\n\t\t\t<form\n\t\t\t\tonSubmit={ this.submit }\n\t\t\t\tonKeyDown={ this.on_key_down }\n\t\t\t\taction={ post }\n\t\t\t\tmethod=\"POST\"\n\t\t\t\tclassName={ classNames('rrui__form', className) }\n\t\t\t\tstyle={ style }\n\t\t\t\tnoValidate>\n\n\t\t\t\t{ this.render_children(error) }\n\t\t\t</form>\n\t\t)\n\n\t\treturn markup\n\t}\n\n\t// Adds `error` element to the form\n\trender_children(error)\n\t{\n\t\tconst { children } = this.props\n\n\t\tconst form_elements = React.Children.toArray(children)\n\n\t\t// Insert `error` element\n\t\tif (error)\n\t\t{\n\t\t\t// Will be set to `null` upon insertion\n\t\t\tlet error_element = <Form.Error key=\"form-error\">{ error }</Form.Error>\n\n\t\t\t// Show form error above form actions,\n\t\t\t// so that the error will be visible and won't be overlooked.\n\t\t\tlet index = 0\n\t\t\tfor (let child of form_elements)\n\t\t\t{\n\t\t\t\tif (child.type === Form.Error)\n\t\t\t\t{\n\t\t\t\t\tform_elements[index] = React.cloneElement(child, { key: 'form-error' }, error)\n\t\t\t\t\terror_element = null\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\tif (child.type === Form.Actions)\n\t\t\t\t{\n\t\t\t\t\tform_elements.insert_at(index, error_element)\n\t\t\t\t\terror_element = null\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\tindex++\n\t\t\t}\n\n\t\t\tif (error_element)\n\t\t\t{\n\t\t\t\tform_elements.push(error_element)\n\t\t\t}\n\t\t}\n\n\t\treturn form_elements\n\t}\n\n\tsubmit(event)\n\t{\n\t\tif (event)\n\t\t{\n\t\t\tevent.preventDefault()\n\t\t}\n\n\t\tconst { busy, submit } = this.props\n\n\t\t// Prevent form double submit\n\t\t// (because not only buttons submit a form,\n\t\t//  therefore just disabling buttons is not enough).\n\t\tif (busy)\n\t\t{\n\t\t\treturn\n\t\t}\n\n\t\tif (submit)\n\t\t{\n\t\t\treturn submit()\n\t\t}\n\t}\n\n\ton_key_down(event)\n\t{\n\t\t// Cancel editing on \"Escape\" key\n\t\tif (event.keyCode === 27)\n\t\t{\n\t\t\tconst { cancel } = this.props\n\n\t\t\tif (cancel)\n\t\t\t{\n\t\t\t\tcancel()\n\t\t\t}\n\n\t\t\tevent.preventDefault()\n\t\t}\n\t}\n}\n\nForm.Error = function({ children })\n{\n\treturn (\n\t\t<div className=\"rrui__form__error\">\n\t\t\t{ children }\n\t\t</div>\n\t)\n}\n\n// Using `Component` here instead of `PureComponent`\n// because it depends on `context` and therefore should be\n// rerendered even if the `props` haven't changed.\nForm.Actions = class Actions extends Component\n{\n\tcomponentWillMount()\n\t{\n\t\tconst { rrui__modal } = this.context\n\n\t\tif (rrui__modal)\n\t\t{\n\t\t\trrui__modal.register_form()\n\t\t}\n\t}\n\n\tcomponentWillUnmount()\n\t{\n\t\tconst { rrui__modal } = this.context\n\n\t\tif (rrui__modal)\n\t\t{\n\t\t\trrui__modal.unregister_form()\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tconst { children, className, style } = this.props\n\t\tconst { rrui__modal } = this.context\n\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName={ classNames('rrui__form__actions', className) }\n\t\t\t\tstyle={ style }>\n\t\t\t\t{ rrui__modal &&\n\t\t\t\t\t<Button action={ rrui__modal.close_if_not_busy }>\n\t\t\t\t\t\t{ rrui__modal.closeLabel }\n\t\t\t\t\t</Button>\n\t\t\t\t}\n\t\t\t\t{ children }\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nForm.Actions.contextTypes =\n{\n\trrui__modal : PropTypes.object\n}"]}